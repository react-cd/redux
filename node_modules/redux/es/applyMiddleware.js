var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

import compose from './compose';

/**
 * Creates a store enhancer that applies middleware to the dispatch method
 * of the Redux store. This is handy for a variety of tasks, such as expressing
 * asynchronous actions in a concise manner, or logging every action payload.
 *
 * See `redux-thunk` package as an example of the Redux middleware.
 *
 * Because middleware is potentially asynchronous, this should be the first
 * store enhancer in the composition chain.
 *
 * Note that each middleware will be given the `dispatch` and `getState` functions
 * as named arguments.
 *
 * @param {...Function} middlewares The middleware chain to be applied.
 * @returns {Function} A store enhancer applying the middleware.
 */
export default function applyMiddleware() {
  for (var _len = arguments.length, middlewares = Array(_len), _key = 0; _key < _len; _key++) {
    middlewares[_key] = arguments[_key];
  }
  console.log('>>>>applyMiddleware');
  console.dir(middlewares);
  return function (createStore) {
    return function (reducer, preloadedState, enhancer) {
      // enhancer 肯定没有值
      var store = createStore(reducer, preloadedState, enhancer);
      var _dispatch = store.dispatch;
      //主要是为了能够让 实现异步组件
      var chain = [];

      var middlewareAPI = {
        getState: store.getState,
        dispatch: function dispatch(action) {
          // debugger
          // 下面重新对齐进行复制了
          return _dispatch(action);
        }
      };
      chain = middlewares.map(function (middleware) {
        return middleware(middlewareAPI);
      });
      console.log('compose.apply(undefined, chain)(');
      var data = compose.apply(undefined, chain)
      console.log('>>>>>>>');
      console.log(data);
      _dispatch = data(store.dispatch,'2');
// _dispatch 已经重写了 最初的dispatch
      return _extends({}, store, {
        dispatch: _dispatch
      });
    };
  };
}